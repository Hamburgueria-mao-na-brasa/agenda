<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#080a10">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Agenda Cyber-Tech Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="image_1ffae0.jpg">
    <link rel="icon" href="image_1ffae0.jpg">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --bg: #080a10; /* Fundo mais escuro */
            --card: #10141d; /* Pain√©is levemente azulados */
            --accent: #ffb400; /* Laranja Neon Gold */
            --accent-glow: rgba(255, 180, 0, 0.4);
            --text: #d0e0f0; /* Texto azulado frio */
            --text-secondary: #8090a0;
            --border: #1f293a; /* Bordas mais vis√≠veis e frias */
            --urgent: #ff3e3e; /* Vermelho mais agressivo */
            --urgent-glow: rgba(255, 62, 62, 0.5);
            --important: #00e5ff; /* Ciano El√©trico */
            --important-glow: rgba(0, 229, 255, 0.5);
            --done: #405060;
        }

        * { box-sizing: border-box; font-family: 'Consolas', 'Monaco', 'Courier New', monospace; /* Fonte Monoespacada */ }
        body { margin: 0; background: var(--bg); color: var(--text); padding: 15px; position: relative; }

        /* Efeito de Scanlines de Fundo */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            z-index: -1;
            pointer-events: none;
        }

        .layout { display: grid; grid-template-columns: 320px 1fr 300px; gap: 20px; max-width: 1600px; margin: auto; }

        /* Pain√©is Tecnol√≥gicos */
        .box { 
            background: var(--card); 
            border: 1px solid var(--border); 
            border-radius: 4px; /* Cantos menos arredondados */
            padding: 20px; 
            box-shadow: 0 0 15px rgba(0,0,0,0.5), inset 0 0 5px rgba(0,0,0,0.2); 
            position: relative;
            overflow: hidden;
        }
        /* Decorativo Angular nos cantos */
        .box::before {
            content: "";
            position: absolute;
            top: -5px; right: -5px; width: 10px; height: 10px;
            background: var(--accent);
            transform: rotate(45deg);
        }

        h3 { 
            margin-top: 0; 
            color: var(--accent); 
            font-size: 1rem; 
            border-bottom: 2px solid var(--border); 
            padding-bottom: 12px; 
            letter-spacing: 1px;
            text-transform: uppercase;
            text-shadow: 0 0 5px var(--accent-glow);
            display: flex; align-items: center; gap: 10px;
        }

        /* Inputs e Bot√µes Cyber-Tech */
        input, textarea, select, button { 
            width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 2px; /* Reto */
            border: 1px solid var(--border); 
            background: rgba(0, 0, 0, 0.4); 
            color: var(--important); /* Texto interno ciano */
            outline: none;
            transition: all 0.2s ease;
        }
        input:focus, textarea:focus, select:focus { 
            border-color: var(--important); 
            box-shadow: 0 0 10px var(--important-glow);
        }

        /* Bot√£o T√°tico */
        button { 
            background: transparent; 
            color: var(--accent); 
            font-weight: bold; 
            border: 1px solid var(--accent); 
            cursor: pointer; 
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        button:hover { 
            background: var(--accent); 
            color: #000; 
            box-shadow: 0 0 15px var(--accent-glow);
        }
        /* Anima√ß√£o de varredura no hover */
        button::after {
            content: "";
            position: absolute;
            top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        button:hover::after { left: 100%; }

        /* Calend√°rio Digital */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day { 
            background: #0d1117; padding: 8px; min-height: 80px; border-radius: 2px; 
            cursor: pointer; position: relative; font-size: 0.85rem; border: 1px solid var(--border);
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        .day:hover { background: rgba(255,255,255,0.05); border-color: #405060; }
        .today { border: 2px solid var(--important) !important; color: var(--important); box-shadow: 0 0 8px var(--important-glow); }
        .selected { 
            background: rgba(255, 180, 0, 0.1) !important; 
            border: 1px solid var(--accent) !important; 
            color: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
            animation: pulseActive 1.5s infinite;
        }
        @keyframes pulseActive { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        
        .dot { height: 5px; width: 5px; background: var(--accent); border-radius: 50%; position: absolute; bottom: 6px; right: 6px; box-shadow: 0 0 5px var(--accent); }

        /* Lista de Compromissos T√°ticos */
        .item { 
            background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 2px; margin-bottom: 10px; 
            display: flex; align-items: flex-start; gap: 12px; border-left: 3px solid #30363d;
            border-bottom: 1px solid transparent;
            transition: 0.2s;
        }
        .item:hover { border-bottom-color: var(--border); }
        
        .item.urgente { border-left-color: var(--urgent); box-shadow: inset 5px 0 10px -5px var(--urgent-glow); }
        .item.importante { border-left-color: var(--important); box-shadow: inset 5px 0 10px -5px var(--important-glow); }
        .item.concluido { opacity: 0.3; text-decoration: line-through; filter: grayscale(1); }
        
        .item-content { flex: 1; color: var(--text); }
        .item-time { color: var(--accent); font-weight: bold; text-shadow: 0 0 5px var(--accent-glow); }

        .btn-check { width: auto; background: none; color: var(--important); border: 1px solid var(--important); padding: 4px 8px; font-size: 0.8rem; }
        .btn-check:hover { background: var(--important); color: #000; }

        #notasArea { height: 180px; resize: none; background: rgba(0,0,0,0.5); border: 1px dashed var(--border); color: #80c0ff; }

        /* Responsividade para Celular */
        @media (max-width: 1000px) { 
            .layout { grid-template-columns: 1fr; }
            .day { min-height: 60px; }
        }
    </style>
</head>
<body>

<div class="layout">
    <div class="box">
        <h3><i class="fas fa-satellite-dish"></i> UP-LINK DADOS</h3>
        <input type="date" id="data">
        <input type="time" id="hora">
        <input type="text" id="titulo" placeholder="ENTRADA T√çTULO">
        <select id="prioridade">
            <option value="normal">‚òï ROTINA</option>
            <option value="importante">‚≠ê PRIORIDADE</option>
            <option value="urgente">üî• CR√çTICO</option>
        </select>
        <textarea id="obs" placeholder="DADOS ADICIONAIS..."></textarea>
        <button onclick="adicionar()"><i class="fas fa-microchip"></i> PROCESSAR REGISTRO</button>
        <button id="installBtn" style="display:none; margin-top:10px; border-color:var(--important); color:var(--important);">üì• INSTALAR PROTOCOLO</button>
        
        <div style="margin-top: 25px;">
            <h3><i class="fas fa-sticky-note"></i> BUFFER NOTAS</h3>
            <textarea id="notasArea" placeholder="MEM√ìRIA VOL√ÅTIL..." oninput="salvarNotas()"></textarea>
        </div>
    </div>

    <div class="box">
        <div class="cal-header">
            <button onclick="mudarMes(-1)" style="width: auto;">‚óÄ</button>
            <h2 id="mesAno" style="margin:0; font-size: 1.1rem; text-transform:uppercase; letter-spacing:1px; text-shadow:0 0 5px var(--accent-glow);"></h2>
            <button onclick="mudarMes(1)" style="width: auto;">‚ñ∂</button>
        </div>
        <div class="grid" id="calendario"></div>
    </div>

    <div class="box">
        <h3 id="tituloLista"><i class="fas fa-list-ul"></i> OPERA√á√ïES</h3>
        <div id="listaTarefas"></div>
    </div>
</div>

<audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<script>
    let agenda = JSON.parse(localStorage.getItem("agendaPessoal")) || [];
    let notas = localStorage.getItem("notasPessoais") || "";
    let hoje = new Date();
    let mesAtual = hoje.getMonth();
    let anoAtual = hoje.getFullYear();
    let dataSelecionada = hoje.toISOString().split('T')[0];

    document.getElementById("notasArea").value = notas;
    document.getElementById("data").value = dataSelecionada;

    // Registro do Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(err => console.log("Erro SW:", err));
    }

    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'block';
    });

    installBtn.addEventListener('click', () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choice) => {
                if (choice.outcome === 'accepted') installBtn.style.display = 'none';
                deferredPrompt = null;
            });
        }
    });

    function salvar() {
        localStorage.setItem("agendaPessoal", JSON.stringify(agenda));
        gerarCalendario();
        mostrarDia(dataSelecionada);
    }

    function salvarNotas() {
        localStorage.setItem("notasPessoais", document.getElementById("notasArea").value);
    }

    function adicionar() {
        const data = document.getElementById("data").value;
        const titulo = document.getElementById("titulo").value;
        if(!data || !titulo) return alert("Preencha data e t√≠tulo!");
        agenda.push({ id: Date.now(), data, hora: document.getElementById("hora").value, titulo, prioridade: document.getElementById("prioridade").value, obs: document.getElementById("obs").value, concluido: false, notificado: false });
        salvar();
        document.getElementById("titulo").value = "";
    }

    function toggleConcluir(id) {
        let tarefa = agenda.find(a => a.id === id);
        tarefa.concluido = !tarefa.concluido;
        salvar();
    }

    function excluir(id) {
        if(confirm("Apagar?")) { agenda = agenda.filter(a => a.id !== id); salvar(); }
    }

    function mudarMes(v) { 
        mesAtual += v; 
        if(mesAtual > 11) { mesAtual = 0; anoAtual++; }
        if(mesAtual < 0) { mesAtual = 11; anoAtual--; }
        gerarCalendario(); 
    }

    function gerarCalendario() {
        const cal = document.getElementById("calendario");
        const nomes = ["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"];
        document.getElementById("mesAno").innerText = `${nomes[mesAtual]} [${anoAtual}]`;
        cal.innerHTML = "";
        const primDia = new Date(anoAtual, mesAtual, 1).getDay();
        const diasNoMes = new Date(anoAtual, mesAtual + 1, 0).getDate();
        for (let i = 0; i < primDia; i++) cal.innerHTML += "<div></div>";
        for (let dia = 1; dia <= diasNoMes; dia++) {
            const dataStr = `${anoAtual}-${String(mesAtual+1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;
            const temCoisa = agenda.some(a => a.data === dataStr && !a.concluido);
            const div = document.createElement("div");
            div.className = "day" + (dataStr === dataSelecionada ? " selected" : "");
            if (dataStr === hoje.toISOString().split('T')[0]) div.classList.add("today");
            div.innerHTML = `<b>${dia.toString().padStart(2, '0')}</b>`;
            if (temCoisa) div.innerHTML += `<span class="dot"></span>`;
            div.onclick = () => { dataSelecionada = dataStr; gerarCalendario(); mostrarDia(dataStr); };
            cal.appendChild(div);
        }
    }

    function mostrarDia(data) {
        const lista = document.getElementById("listaTarefas");
        const itens = agenda.filter(a => a.data === data).sort((a,b) => a.hora.localeCompare(b.hora));
        document.getElementById("tituloLista").innerHTML = `<i class="fas fa-calendar-day"></i> ${data.split("-").reverse().join(".")}`;
        lista.innerHTML = itens.length ? "" : "<p style='text-align:center; color:#444; font-size:0.8rem;'>NO_OPERATIONS_PENDING</p>";
        itens.forEach(i => {
            lista.innerHTML += `
                <div class="item ${i.prioridade} ${i.concluido ? 'concluido' : ''}">
                    <div class="item-content">
                        <span class="item-time"><i class="fas fa-clock"></i> ${i.hora || '--:--'}</span> | 
                        <b>${i.titulo}</b>
                    </div>
                    <button class="btn-check" onclick="toggleConcluir(${i.id})">${i.concluido ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-check"></i>'}</button>
                    <button onclick="excluir(${i.id})" style="width:auto; background:none; color:var(--urgent); border:none; padding:4px;"><i class="fas fa-trash-alt"></i></button>
                </div>`;
        });
    }

    // Sistema de Notifica√ß√µes
    setInterval(() => {
        const agora = new Date();
        const horaAtual = agora.getHours().toString().padStart(2, '0') + ":" + agora.getMinutes().toString().padStart(2, '0');
        const dataHoje = agora.toISOString().split('T')[0];
        agenda.forEach(t => {
            if (!t.concluido && !t.notificado && t.data === dataHoje && t.hora === horaAtual) {
                if (Notification.permission === "granted") new Notification("‚è∞ PROTOCOLO ATIVO: " + t.titulo);
                document.getElementById("notifSound").play().catch(() => {});
                t.notificado = true;
                localStorage.setItem("agendaPessoal", JSON.stringify(agenda));
            }
        });
    }, 30000);

    gerarCalendario();
    mostrarDia(dataSelecionada);
</script>
</body>
</html>